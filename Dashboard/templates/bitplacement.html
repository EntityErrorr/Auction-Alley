{% extends 'basee.html' %}

{% block content %}
<style>
    /* Your custom styles here */
    body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        margin: 20px;
    }
    .container {
        max-width: 1000px;
        margin: auto;
        background: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: row;
    }
    .left-column {
        flex: 1;
        margin-right: 20px;
    }
    .right-column {
        flex: 1;
    }
    .auction-image img {
        width: 100%;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .time-left {
        text-align: center;
        margin-top: 10px;
        font-size: 18px;
        color: #ff0000;
        font-weight: bold;
    }
    h1, h2 {
        text-align: center;
        margin-bottom: 20px;
    }
    label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
    }
    input, textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 16px;
    }
    button {
        background-color: #4CAF50;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        font-size: 16px;
    }
    button:hover {
        background-color: #45a049;
    }
    .notification {
        text-align: center;
        margin-top: 20px;
        font-size: 18px;
        color: #ff0000;
        font-weight: bold;
        display: none; /* Initially hidden */
    }
</style>
<div class="container">
    <div class="left-column">
        <div class="time-left">
            Time left: {{ auction.end_time|timesince }} remaining
        </div>
        <div class="auction-image">
            <img src="{{ auction.image.url }}" alt="House Image">
        </div>
    </div>
    <div class="right-column">
        <h1>{{ auction.title }}</h1>
        <div>
            <p><strong>Description:</strong> {{ auction.description }}</p>
            <p><strong>Address:</strong> {{ auction.address }}</p>
            <p><strong>Starting Bid:</strong> ${{ auction.starting_bid }}</p>
            <p><strong>Current Bid:</strong> $<span id="current-bid">{{ auction.current_bid }}</span></p>
            <p><strong>Seller:</strong> {{ auction.seller.username }}</p>
            <p><strong>Category:</strong> {{ auction.category.title }}</p>
        </div>

        <h2>Place a Bid</h2>
        <form id="bid-form" method="post" action="{% url 'dashboard:bitplacement' auction.id %}">
            {% csrf_token %}
            {{ bid_form.as_p }}
            <button type="submit">Place Bid</button>
        </form>
        
        <div class="notification" id="notification"></div>
    </div>
</div>

<script>
    document.getElementById('bid-form').addEventListener('submit', function(event) {
        event.preventDefault();
        var form = this;
        var formData = new FormData(form);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', form.action, true);
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
        xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    document.getElementById('current-bid').innerText = response.current_bid;
                    var notification = document.getElementById('notification');
                    notification.innerText = response.message;
                    notification.style.display = 'block';
                    if (response.success) {
                        notification.style.color = 'green';
                    } else {
                        notification.style.color = 'red';
                    }
                } else {
                    var notification = document.getElementById('notification');
                    notification.innerText = 'An error occurred. Please try again.';
                    notification.style.display = 'block';
                    notification.style.color = 'red';
                }
            }
        };
        xhr.send(formData);
    });
</script>

{% endblock %}